---
title: 'Low-level API'
linkTitle: 'Low-level API'
weight: 3
description: ''
---

## Overview

Low-level API is useful if you need to work directly with REST API, but want
to have data validation and syntax assistance from your code editor. The code
on this layer is autogenerated.

Code of this component is located in `cvat_sdk.api_client`.

## Example

Let's see how a task with local files can be created. We will use the basic auth
to make things simpler.

```python
from time import sleep
from cvat_sdk.api_client import Configuration, ApiClient, models, apis, exceptions

configuration = Configuration(
    host="http://localhost",
    username='YOUR_USERNAME',
    password='YOUR_PASSWORD',
)

# Enter a context with an instance of the API client
with ApiClient(configuration) as api_client:
    # Parameters can be passed as a plain dict with JSON-serialized data
    # or as model objects (from cvat_sdk.api_client.models), including
    # mixed variants.
    #
    # In case of dicts, keys must be the same as members of models.I<ModelName>
    # interfaces and values must be convertible to the corresponding member
    # value types (e.g. a date or string enum value can be parsed from a string).
    #
    # In case of model objects, data must be of the corresponding
    # models.<ModelName> types.
    #
    # Let's use a dict here. It should look like models.ITaskWriteRequest
    task_spec = {
        'name': 'example task',
        "labels": [{
            "name": "car",
            "color": "#ff00ff",
            "attributes": [
                {
                    "name": "a",
                    "mutable": True,
                    "input_type": "number",
                    "default_value": "5",
                    "values": ["4", "5", "6"]
                }
            ]
        }],
    }

    try:
        # Apis can be accessed as ApiClient class members
        # We use different models for input and output data. For input data,
        # models are typically called like "*Request". Output data models have
        # no suffix.
        (task, response) = api_client.tasks_api.create(task_spec)
    except exceptions.ApiException as e:
        # We can catch the basic exception type, or a derived type
        print("Exception when trying to create a task: %s\n" % e)

    # Here we will use models instead of a dict
    task_data = models.DataRequest(
        image_quality=75,
        client_files=[
            open('image1.jpg', 'rb'),
            open('image2.jpg', 'rb'),
        ],
    )

    # If we pass binary file objects, we need to specify content type.
    # For this endpoint, we don't have response data
    (_, response) = api_client.tasks_api.create_data(task.id,
        data_request=task_data,
        _content_type="multipart/form-data",

        # we can choose to check the response status manually
        # and disable the response data parsing
        _check_status=False, _parse_response=False
    )
    assert response.status == 202, response.msg

    # Wait till task data is processed
    for _ in range(100):
        (status, _) = api_client.tasks_api.retrieve_status(task.id)
        if status.state.value in ['Finished', 'Failed']:
            break
        sleep(0.1)
    assert status.state.value == 'Finished', status.message

    # Update the task object and check the task size
    (task, _) = api_client.tasks_api.retrieve(task.id)
    assert task.size == 4
```

## ApiClient and configuration

The starting point in the low-level API is the `cvat_sdk.api_client.ApiClient` class.
It encapsulates session and connection logic, and provides simpler access to different APIs.

To create an instance of `ApiClient`, you need to set up a `cvat_sdk.api_client.Configuration`
object and pass it to the `ApiClient` class constructor. Additional connection-specific
options, such as extra headers and cookies can be specified in the class constructor.
`ApiClient` implements the context manager protocol. Typically, you create `ApiClient` this way:

```python
from cvat_sdk.api_client import ApiClient, Configuration

configuration = Configuration(host="http://localhost")
with ApiClient(configuration) as api_client:
    ...
```

After creating an `ApiClient` instance, you can send requests to different server endpoints
via `*_api` member properties and directly, using the `rest_client` member.
[Read more](#api-wrappers) about API wrappers below.

Typically, the first thing you do with `ApiClient` is login.
[Read more](#authentication) about authentication options below.

## Authentication

CVAT supports 2 authentication options:
- basic auth, with your username and password
- token auth, with your API key

Token auth requires a token, which can be obtained after performing the basic auth.

Low-level API supports 2 ways of authorization.
You can specify authorization in the `Configuration` object:

```python
configuration = Configuration(
    username='YOUR_USERNAME',
    password='YOUR_PASSWORD',
)
```

```python
configuration = Configuration(
    api_key={
        "sessionAuth": "<sessionid cookie value>",
        "csrfAuth": "<csrftoken cookie value>",
        "tokenAuth": "Token <auth key value>",
    }
)
```

Or you can perform regular login using the `auth_api` member of `ApiClient` and
set the `Authorization` header using the `Token` prefix.

```python
from cvat_sdk.api_client import models

(auth, _) = api_client.auth_api.create_login(
    models.LoginRequest(username=credentials[0], password=credentials[1])
)

assert "sessionid" in api_client.cookies
assert "csrftoken" in api_client.cookies
api_client.set_default_header("Authorization", "Token " + auth.key)
```

## API wrappers

API endpoints are grouped by tags into separate classes in the `cvat_sdk.api_client.apis` package.

APIs can be accessed as `ApiClient` object members:

```python
api_client.auth_api.<operation>(...)
api_client.tasks_api.<operation>(...)
```

And APIs can be instantiated directly like this:

```python
from cvat_sdk.api_client import ApiClient, apis

api_client = ApiClient(...)

auth_api = apis.AuthApi(api_client)
auth_api.<operation>(...)

tasks_api = apis.TasksApi(api_client)
tasks_api.<operation>(...)
```

Each operation provides metainfo in the `<operation>_endpoint` member.

You can find the list of the available APIs and their documentation [here](apis/)

## Models

Requests and responses can include parameters. These parameters can be plain python
objects, or models. In CVAT API, models for requests and responses are separated.
Request models have the `Request` suffix in the name. Models can be found in the
`cvat_sdk.api_client.models` package.

Models can be instantiated like this:

```python
from cvat_sdk.api_client import models

user_model = models.User(...)
```

Model parameters can be passed as models, or as plain python objects. This rule applies
recursively, starting from the method parameters. In particular, this means you can pass
a plain dict into a method or into a model constructor, and corresponding fields will
be parsed from this data automatically:

```python
task_spec = models.TaskWriteRequest(
    name='example task',
    labels=[
        models.PatchedLabelRequest(
            name="car",
            color="#ff00ff",
            attributes=[
                model.AttributeRequest(
                    name="a",
                    mutable=True,
                    input_type="number",
                    default_value="5",
                    values=["4", "5", "6"]
                )
            ]
        )
    ],
)
api_client.tasks_api.create(task_spec)
```

Is equivalent to:

```python
api_client.tasks_api.create({
    'name': 'example task',
    "labels": [{
        "name": "car",
        "color": "#ff00ff",
        "attributes": [
            {
                "name": "a",
                "mutable": True,
                "input_type": "number",
                "default_value": "5",
                "values": ["4", "5", "6"]
            }
        ]
    }],
})
```

You can mix these variants.

Most models provide corresponding interface classes called like `I<model name>`. They can be
used to implement your own classes or describe APIs. They just provide type annotations
and descriptions for model fields.

You can export model values to plain python dicts using the `as_dict()` method and
the `cvat_sdk.api_client.model_utils.to_json()` function.

You can find the list of the available models and their documentation [here](models/)
